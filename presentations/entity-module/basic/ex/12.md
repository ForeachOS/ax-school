## Oefening 12

### Een bestaande property control aanpassen

Ondersteun rich-text met behulp van CKEditor op het `remarks` veld van een `BookingFollowup`.  

Gebruik volgende Javascript resources om rich-text te activeren:
   
`/static/booking/js/rich-text.js`    
`https://cdn.ckeditor.com/ckeditor5/11.1.1/classic/ckeditor.js` 

----

### Tips

* Collection element properties hebben hun eigen descriptor van de vorm: `collection[].property`
* De `rich-text.js` javascript activeert CKEditor automatisch wanneer een html attribuut aanwezig is.

----

### Relevante documentatie

* [Property controls](https://across-docs.foreach.be/across-site/production/entity-module/3.2.0/property-controls/index.html)

----

### Oplossing

**Invoice configuration**
```java
entities.withType( Booking.class )
        .formView( "invoice",
                   EntityViewCustomizers.basicSettings()
                                        .adminMenu( "/invoice" )
                                        .andThen(
                                                fvb -> fvb.showProperties( "invoice.*", "followUp" )
                                                          .properties(
                                                                  props -> props.property( "followUp[].remarks" )
                                                                                .viewElementPostProcessor( ViewElementMode.CONTROL, applyWysiwyg() )
                                                          )
                                        )
        );
```

**Enable rich-text**
```java
	private ViewElementPostProcessor<TextboxFormElement> applyWysiwyg() {
		return ( builderContext, element ) -> {
			WebResourceRegistry webResourceRegistry = builderContext.getAttribute( WebResourceRegistry.class );
			webResourceRegistry.add( WebResource.JAVASCRIPT, "https://cdn.ckeditor.com/ckeditor5/11.1.1/classic/ckeditor.js", WebResource.EXTERNAL );
			webResourceRegistry.add( WebResource.JAVASCRIPT_PAGE_END, "/static/booking/js/rich-text.js", WebResource.VIEWS );
			element.setAttribute( "rich-text", true );
		};
	}
```

