## Oefening 13
### Een custom control maken

Zorg ervoor dat een `Booking` property value **altijd** een link is naar de detail view van de `Booking` entity,  
in plaats van enkel de naam van de reservatie.

Booking moet een link worden zowel bij `Invoice` als bij `Seat`,  
zowel op de detail view als op de overzichtspagina.
    
----

### Tips
        
* Bug workaround: Om het link element juist te renderen kan je deze best nog eens in een `ContainerViewElement` wrappen.
* Als je view element configuraties op de `Booking` entity configuratie opgeeft, dan geldt die by default voor alle properties van dat entity type.
* Je kunt `EntityViewLinks` component gebruiken om de links naar geregistreerde entities te leggen.
* Via `EntitViewElementUtils` kan je de huidige waarde van een property uit de `ViewElementBuilderContext` halen.

----
### Relevante documentatie
         
* [Customizing entity property controls](https://across-docs.foreach.be/across-site/production/entity-module/3.2.0/property-controls/index.html)
* [Creating a custom ViewElementBuilder](https://across-docs.foreach.be/across-site/production/entity-module/3.2.0/guides/general/creating-custom-control-for-object-type.html#_creating_a_custom_viewelementbuilder)

----

### Oplossing

**Custom ViewElementBuilder**
```java
@Component
@RequiredArgsConstructor
public class BookingLinkViewBuilder implements ViewElementBuilder<ContainerViewElement>
{
	private final EntityViewLinks viewLinks;

	@Override
	public ContainerViewElement build( ViewElementBuilderContext builderContext ) {
		Booking booking = EntityViewElementUtils.currentPropertyValue( builderContext, Booking.class );
		return BootstrapUiBuilders.container()
		                          .add( BootstrapUiBuilders.link()
		                                                   .url( viewLinks.linkTo( booking ).toString() )
		                                                   .text( booking.getEmail() ) )
		                          .build( builderContext );
	}
}
```

**Invoice configuration**
```java
entities.withType( Invoice.class )
        .properties(
                props -> props.property( "booking" )
                              .propertyType( TypeDescriptor.valueOf( Booking.class ) )
                              .readable( true )
                              .viewElementBuilder( ViewElementMode.VALUE, bookingLinkViewBuilder )
                              .viewElementBuilder( ViewElementMode.LIST_VALUE, bookingLinkViewBuilder )
                              .valueFetcher( bookingRepository::findByInvoice )
        )
        .updateFormView( fvb -> fvb.showProperties( ".", "booking" ) )
        .listView( lvb -> lvb.showProperties( ".", "booking" ) );
```

**Seat configuration**
```java
entities.withType( Seat.class )
        .properties(
                props -> props.property( "booking" )
                              .viewElementBuilder( ViewElementMode.LIST_VALUE, bookingLinkViewBuilder )
        );
```