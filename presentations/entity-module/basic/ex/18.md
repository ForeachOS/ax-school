### Oefening 18: custom control

* Booking als property configureren op invoice, en daar link naar detail view van maken
* Dit ook doen bij seat, dat LIST_VALUE default die link view gebruikt
* Tonen in popup!
    
----

### Tips & Relevante documentatie
        
* Om het link element juist te renderen kan je deze best nog eens in een `ContainerViewElement` wrappen.         
* [Customizing entity property controls](https://across-docs.foreach.be/across-site/production/entity-module/3.2.0/property-controls/index.html)
* [Creating a custom ViewElementBuilder](https://across-docs.foreach.be/across-site/production/entity-module/3.2.0/guides/general/creating-custom-control-for-object-type.html#_creating_a_custom_viewelementbuilder)

----

### Oplossing

#### Custom ViewElementBuilder

```java
@Component
@RequiredArgsConstructor
public class BookingLinkViewBuilder implements ViewElementBuilder<ContainerViewElement>
{
	private final EntityViewLinks viewLinks;

	@Override
	public ContainerViewElement build( ViewElementBuilderContext builderContext ) {
		Booking booking = EntityViewElementUtils.currentPropertyValue( builderContext, Booking.class );
		return BootstrapUiBuilders.container()
		                          .add( BootstrapUiBuilders.link()
		                                                   .url( viewLinks.linkTo( booking ).toString() )
		                                                   .text( booking.getEmail() ) )
		                          .build( builderContext );
	}
}
```

#### Invoice configuration

```java
entities.withType( Invoice.class )
        .properties(
                props -> props.property( "booking" )
                              .propertyType( TypeDescriptor.valueOf( Booking.class ) )
                              .readable( true )
                              .viewElementBuilder( ViewElementMode.VALUE, bookingLinkViewBuilder )
                              .viewElementBuilder( ViewElementMode.LIST_VALUE, bookingLinkViewBuilder )
                              .valueFetcher( bookingRepository::findByInvoice )
        )
        .updateFormView( fvb -> fvb.showProperties( ".", "booking" ) )
        .listView( lvb -> lvb.showProperties( ".", "booking" ) );
```

#### Seat configuration

```java
entities.withType( Seat.class )
        .properties(
                props -> props.property( "booking" )
                              .viewElementBuilder( ViewElementMode.LIST_VALUE, bookingLinkViewBuilder )
        );
```